<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pencatat Kebugaran - SMK Cokroaminoto 2 Banjarnegara</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        header {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        h1 {
            color: #667eea;
            font-size: 24px;
        }

        .dashboard {
            display: grid;
            grid-template-columns: 250px 1fr 300px;
            gap: 20px;
            margin-bottom: 20px;
        }

        .panel {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .panel h2 {
            color: #667eea;
            margin-bottom: 15px;
            font-size: 18px;
            border-bottom: 2px solid #667eea;
            padding-bottom: 10px;
        }

        .datetime {
            font-size: 16px;
            color: #333;
            margin-bottom: 15px;
        }

        .datetime .time {
            font-size: 28px;
            font-weight: bold;
            color: #667eea;
        }

        .datetime .date {
            color: #666;
            margin-top: 5px;
        }

        select, input {
            width: 100%;
            padding: 10px;
            margin: 10px 0;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
        }

        .class-list, .student-list {
            margin-top: 15px;
        }

        .class-item, .student-item {
            padding: 12px;
            margin: 8px 0;
            background: #f7fafc;
            border-left: 4px solid #667eea;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .class-item:hover, .student-item:hover {
            background: #edf2f7;
            transform: translateX(5px);
        }

        .chart-container {
            height: 300px;
            margin: 20px 0;
            background: #f7fafc;
            border-radius: 5px;
            padding: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #666;
        }

        .kpi-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin: 20px 0;
        }

        .kpi-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
        }

        .kpi-card .value {
            font-size: 32px;
            font-weight: bold;
            margin: 10px 0;
        }

        .kpi-card .label {
            font-size: 14px;
            opacity: 0.9;
        }

        .notes-list {
            max-height: 400px;
            overflow-y: auto;
        }

        .note-item {
            padding: 12px;
            margin: 8px 0;
            background: #fff5f5;
            border-left: 4px solid #f56565;
            border-radius: 5px;
            font-size: 14px;
        }

        .suggestion-item {
            padding: 12px;
            margin: 8px 0;
            background: #f0fff4;
            border-left: 4px solid #48bb78;
            border-radius: 5px;
            font-size: 14px;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 10px;
            max-width: 600px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #666;
        }

        .form-group {
            margin: 15px 0;
        }

        label {
            display: block;
            margin-bottom: 5px;
            color: #333;
            font-weight: 500;
        }

        .checkbox-group {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin: 10px 0;
        }

        .checkbox-group label {
            display: flex;
            align-items: center;
            margin: 0;
            font-weight: normal;
        }

        .checkbox-group input {
            width: auto;
            margin-right: 5px;
        }

        button.primary {
            background: #667eea;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            width: 100%;
            margin-top: 10px;
        }

        button.primary:hover {
            background: #5568d3;
        }

        .loading {
            text-align: center;
            padding: 20px;
            color: #666;
        }

        textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
            font-family: inherit;
            min-height: 80px;
        }

        @media (max-width: 1024px) {
            .dashboard {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .kpi-grid {
                grid-template-columns: 1fr;
            }
        }

        .alert {
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
            display: none;
        }

        .alert.success {
            background: #f0fff4;
            border-left: 4px solid #48bb78;
            color: #2f855a;
        }

        .alert.error {
            background: #fff5f5;
            border-left: 4px solid #f56565;
            color: #c53030;
        }

        .teacher-name {
            margin: 10px 0;
        }

        .teacher-name input {
            margin: 5px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üìä Pencatat Kebugaran - SMK Cokroaminoto 2 Banjarnegara</h1>
        </header>

        <div id="alert" class="alert"></div>

        <div class="dashboard">
            <!-- Panel Kiri -->
            <div class="panel">
                <h2>‚è∞ Waktu & Jadwal</h2>
                <div class="datetime">
                    <div class="time" id="currentTime">--:--:--</div>
                    <div class="date" id="currentDate">Loading...</div>
                </div>

                <div class="teacher-name">
                    <label>Nama Guru:</label>
                    <input type="text" id="teacherName" placeholder="Masukkan nama Anda" value="Pak/Bu Guru">
                </div>
                
                <select id="filterDay">
                    <option value="today">Hari Ini</option>
                    <option value="week">Minggu Ini</option>
                    <option value="all">Semua</option>
                </select>

                <div class="class-list" id="classList">
                    <div class="loading">Memuat kelas...</div>
                </div>
            </div>

            <!-- Panel Tengah -->
            <div class="panel">
                <h2>üìà Dashboard & Perkembangan</h2>
                
                <div class="kpi-grid">
                    <div class="kpi-card">
                        <div class="label">Siswa Hari Ini</div>
                        <div class="value" id="kpiStudents">0</div>
                    </div>
                    <div class="kpi-card">
                        <div class="label">Rata-rata 100m (detik)</div>
                        <div class="value" id="kpiRun">-</div>
                    </div>
                    <div class="kpi-card">
                        <div class="label">Rata-rata Push Up</div>
                        <div class="value" id="kpiPushup">-</div>
                    </div>
                    <div class="kpi-card">
                        <div class="label">Rata-rata Sit Up</div>
                        <div class="value" id="kpiSitup">-</div>
                    </div>
                </div>

                <div class="chart-container">
                    <p>Grafik perkembangan akan ditampilkan di sini<br>(Integrasi dengan Google Spreadsheet)</p>
                </div>

                <div id="studentList" style="display:none;">
                    <h3 style="color:#667eea; margin:20px 0 10px 0;">Daftar Siswa</h3>
                    <div id="students"></div>
                </div>
            </div>

            <!-- Panel Kanan -->
            <div class="panel">
                <h2>üìù Catatan & Saran</h2>
                <div class="notes-list" id="notesList">
                    <div class="suggestion-item">
                        <strong>üí° Saran Sistem:</strong><br>
                        Sistem akan memberikan saran otomatis berdasarkan data perkembangan siswa.
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Form Pencatatan -->
    <div id="recordModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalTitle">Pencatatan Kebugaran</h2>
                <button class="close-btn" onclick="closeModal()">&times;</button>
            </div>

            <div class="form-group">
                <label>Nama Siswa:</label>
                <input type="text" id="studentName" readonly>
            </div>

            <div class="form-group">
                <label>Jenis Tes:</label>
                <select id="testType">
                    <option value="100m">Lari 100 Meter</option>
                    <option value="pushup">Push Up</option>
                    <option value="situp">Sit Up</option>
                </select>
            </div>

            <div class="form-group">
                <label>Nilai/Hasil:</label>
                <input type="number" id="testValue" step="0.01" placeholder="Masukkan nilai">
            </div>

            <div class="form-group">
                <label>Status/Observasi:</label>
                <div class="checkbox-group">
                    <label><input type="checkbox" value="bersemangat"> Bersemangat</label>
                    <label><input type="checkbox" value="mengantuk"> Mengantuk</label>
                    <label><input type="checkbox" value="tidak_sehat"> Tidak Sehat</label>
                    <label><input type="checkbox" value="sakit"> Sakit</label>
                    <label><input type="checkbox" value="terlambat"> Terlambat</label>
                    <label><input type="checkbox" value="absen"> Absen</label>
                </div>
            </div>

            <div class="form-group">
                <label>Keterangan Tambahan:</label>
                <textarea id="remarks" placeholder="Catatan tambahan..."></textarea>
            </div>

            <button class="primary" onclick="saveMeasurement()">üíæ Simpan Data</button>
        </div>
    </div>

    <script>
        // Konfigurasi - GANTI DENGAN URL GOOGLE APPS SCRIPT ANDA
        const CONFIG = {
            API_URL: 'https://script.google.com/macros/s/AKfycbzz1IMlpzn9G-WVoAf9rl78KmiUYJX9SzT2yGZBItNU85KVLYxDonWbSDWRq8s0fk2b/exec',
        };

        let currentStudentId = null;
        let currentClassId = null;

        // Update waktu sekarang
        function updateDateTime() {
            const now = new Date();
            const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            
            document.getElementById('currentTime').textContent = now.toLocaleTimeString('id-ID');
            document.getElementById('currentDate').textContent = now.toLocaleDateString('id-ID', options);
        }

        setInterval(updateDateTime, 1000);
        updateDateTime();

        // Load daftar kelas
        async function loadClasses() {
            try {
                // Demo data
                const demoClasses = [
                    { ClassID: 'C001', ClassName: 'X-RPL', DayOfWeek: 'Senin', StartTime: '07:00', Teacher: 'Pak Budi' },
                    { ClassID: 'C002', ClassName: 'XI-TKJ', DayOfWeek: 'Selasa', StartTime: '08:00', Teacher: 'Bu Ani' }
                ];

                const classList = document.getElementById('classList');
                classList.innerHTML = demoClasses.map(cls => `
                    <div class="class-item" onclick="selectClass('${cls.ClassID}', '${cls.ClassName}')">
                        <strong>${cls.ClassName}</strong><br>
                        <small>${cls.DayOfWeek} | ${cls.StartTime} | ${cls.Teacher}</small>
                    </div>
                `).join('');

                // Load dari API jika tersedia
                if (CONFIG.API_URL !== 'YOUR_GOOGLE_APPS_SCRIPT_URL_HERE') {
                    const response = await fetch(`${CONFIG.API_URL}?action=getClasses`);
                    const data = await response.json();
                    if (data.classes) {
                        classList.innerHTML = data.classes.map(cls => `
                            <div class="class-item" onclick="selectClass('${cls.ClassID}', '${cls.ClassName}')">
                                <strong>${cls.ClassName}</strong><br>
                                <small>${cls.DayOfWeek} | ${cls.StartTime} | ${cls.Teacher}</small>
                            </div>
                        `).join('');
                    }
                }
            } catch (error) {
                console.error('Error loading classes:', error);
                showAlert('Gagal memuat data kelas. Menggunakan data demo.', 'error');
            }
        }

        // Pilih kelas dan load siswa
        async function selectClass(classId, className) {
            currentClassId = classId;
            
            try {
                // Demo data
                const demoStudents = Array.from({length: 6}, (_, i) => ({
                    StudentID: `S${String(i+1).padStart(3, '0')}`,
                    Name: `Siswa ${i+1}`,
                    ClassID: classId,
                    NIS: `20240${i+1}`
                }));

                const studentList = document.getElementById('studentList');
                const students = document.getElementById('students');
                
                studentList.style.display = 'block';
                students.innerHTML = demoStudents.map(student => `
                    <div class="student-item" onclick="openRecordModal('${student.StudentID}', '${student.Name}')">
                        <strong>${student.Name}</strong> - NIS: ${student.NIS}
                    </div>
                `).join('');

                // Load dari API jika tersedia
                if (CONFIG.API_URL !== 'YOUR_GOOGLE_APPS_SCRIPT_URL_HERE') {
                    const response = await fetch(`${CONFIG.API_URL}?action=getStudents&classId=${classId}`);
                    const data = await response.json();
                    if (data.students) {
                        students.innerHTML = data.students.map(student => `
                            <div class="student-item" onclick="openRecordModal('${student.StudentID}', '${student.Name}')">
                                <strong>${student.Name}</strong> - NIS: ${student.NIS}
                            </div>
                        `).join('');
                    }
                }

                updateKPI(classId);
            } catch (error) {
                console.error('Error loading students:', error);
                showAlert('Gagal memuat data siswa.', 'error');
            }
        }

        // Update KPI
        async function updateKPI(classId) {
            // Demo values
            document.getElementById('kpiStudents').textContent = '6';
            document.getElementById('kpiRun').textContent = '15.2';
            document.getElementById('kpiPushup').textContent = '25';
            document.getElementById('kpiSitup').textContent = '30';

            // Load dari API jika tersedia
            if (CONFIG.API_URL !== 'YOUR_GOOGLE_APPS_SCRIPT_URL_HERE') {
                try {
                    const response = await fetch(`${CONFIG.API_URL}?action=getDashboard&classId=${classId}`);
                    const data = await response.json();
                    if (data.kpi) {
                        document.getElementById('kpiStudents').textContent = data.kpi.students || '0';
                        document.getElementById('kpiRun').textContent = data.kpi.avgRun || '-';
                        document.getElementById('kpiPushup').textContent = data.kpi.avgPushup || '-';
                        document.getElementById('kpiSitup').textContent = data.kpi.avgSitup || '-';
                    }
                } catch (error) {
                    console.error('Error loading KPI:', error);
                }
            }
        }

        // Open modal untuk pencatatan
        function openRecordModal(studentId, studentName) {
            currentStudentId = studentId;
            document.getElementById('studentName').value = studentName;
            document.getElementById('recordModal').classList.add('active');
        }

        // Close modal
        function closeModal() {
            document.getElementById('recordModal').classList.remove('active');
            document.getElementById('testValue').value = '';
            document.getElementById('remarks').value = '';
            document.querySelectorAll('.checkbox-group input').forEach(cb => cb.checked = false);
        }

        // Simpan pengukuran
        async function saveMeasurement() {
            const testType = document.getElementById('testType').value;
            const testValue = document.getElementById('testValue').value;
            const remarks = document.getElementById('remarks').value;
            const teacherName = document.getElementById('teacherName').value || 'Guru';
            
            const flags = Array.from(document.querySelectorAll('.checkbox-group input:checked'))
                .map(cb => cb.value)
                .join(',');

            if (!testValue) {
                showAlert('Nilai/hasil harus diisi!', 'error');
                return;
            }

            const measurement = {
                StudentID: currentStudentId,
                ClassID: currentClassId,
                Date: new Date().toISOString().split('T')[0],
                Time: new Date().toLocaleTimeString('id-ID'),
                TestType: testType,
                Value: testValue,
                Unit: testType === '100m' ? 'detik' : 'rep',
                Flags: flags,
                Remarks: remarks,
                RecordedBy: teacherName
            };

            try {
                if (CONFIG.API_URL !== 'YOUR_GOOGLE_APPS_SCRIPT_URL_HERE') {
                    const response = await fetch(CONFIG.API_URL, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ action: 'saveMeasurement', data: measurement })
                    });
                    const result = await response.json();
                    
                    if (result.success) {
                        showAlert('Data berhasil disimpan!', 'success');
                        closeModal();
                        updateKPI(currentClassId);
                    } else {
                        showAlert('Gagal menyimpan data: ' + result.error, 'error');
                    }
                } else {
                    // Demo mode
                    console.log('Measurement saved (demo):', measurement);
                    showAlert('Data tersimpan (mode demo). Hubungkan dengan Google Apps Script untuk menyimpan ke Spreadsheet.', 'success');
                    closeModal();
                }
            } catch (error) {
                console.error('Error saving measurement:', error);
                showAlert('Error: ' + error.message, 'error');
            }
        }

        // Show alert
        function showAlert(message, type) {
            const alert = document.getElementById('alert');
            alert.textContent = message;
            alert.className = `alert ${type}`;
            alert.style.display = 'block';
            setTimeout(() => alert.style.display = 'none', 5000);
        }

        // Initialize
        window.onload = function() {
            loadClasses();
            // Load saved teacher name if exists
            const savedName = localStorage.getItem('teacherName');
            if (savedName) {
                document.getElementById('teacherName').value = savedName;
            }
            
            // Save teacher name on change
            document.getElementById('teacherName').addEventListener('change', function() {
                localStorage.setItem('teacherName', this.value);
            });
        };
    </script>
</body>
</html>
